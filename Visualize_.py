from VisData import VisData

import numpy as np
import matplotlib.pyplot as plt


from cycler import cycler
from matplotlib.collections import EventCollection
from VisData import VisData


class Visualize_:


    def __init__(self,\
            data : VisData, 
            color_arr : list = ['c', 'm', 'y', 'k'],\
            linestyle_arr : list = ['-', '--', ':', '-.']):

        self.data : VisData = data

        self.color_arr : list = color_arr
        self.linestyle_arr : list = linestyle_arr
        self.fig : plt.figure = plt.figure()
        self.fig.suptitle("Metric performance over increasingly damaged data")
        self.default_cycler : cycler = (cycler(color=self.color_arr) +
            cycler(linestyle=self.linestyle_arr))


    def get_data(self, key : str, descr : str):
        # x value as deterioration step, y value as different metrices
            plot_data = [(x, np.asarray(list(y.values())) ) for x, y in self.data.combined_data[key]['mean']]
            # unzipping values
            plot_data : list = list(zip(*plot_data))
            x_data, y_data = np.asarray(plot_data[0]), np.asarray(plot_data[1])
            return x_data, y_data


    def plot(self):

        style_properties : list = list(self.default_cycler)
        
        for i, key in enumerate(self.data.combined_data.keys()):

            x_data, y_data_mean = self.get_data(key, 'mean')
            _ , y_data_scatter = self.get_data(key, 'data')
            
            # set up graph
            submetrics : int = np.shape(y_data_mean)[1]
            ax : plt.axes._subplots.AxesSubplot = self.fig.add_subplot(2,3, i + 1)
            ax.set_xlim((-0.1,1))
            ax.set_ylim((-0.1,1.1))

            for j in range(submetrics):
                # display mean
                ax.scatter(x_data, y_data_mean[:, j])
                ax.plot(x_data, y_data_mean[:, j])

                # ax.boxplot(y_data_scatter)
                # ax.set_xticklabels(x_data)  

        plt.show()


example_data : tuple = ('negated',
 [(0.5,
   [({'P': [0.9849, 0.9855, 0.9922, 1.0000, 0.9859, 0.9774, 1.0000, 1.0000, 0.9933,
              1.0000, 1.0000, 1.0000, 1.0000, 0.9909, 1.0000, 0.9935, 1.0000, 1.0000,
              1.0000, 0.9860, 1.0000, 1.0000, 0.9930, 1.0000, 0.9808, 1.0000, 0.9751,
              1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 0.9860, 1.0000,
              0.9922, 1.0000, 0.9898, 1.0000, 1.0000, 1.0000, 0.9721, 1.0000, 0.9805,
              0.9908, 0.9797, 1.0000, 1.0000, 0.9860, 1.0000, 1.0000, 0.9826, 0.9766,
              0.9844, 1.0000],
      'R': [0.9772, 0.9767, 0.9867, 1.0000, 0.9727, 0.9601, 1.0000, 1.0000, 0.9892,
              1.0000, 1.0000, 1.0000, 1.0000, 0.9840, 1.0000, 0.9885, 1.0000, 1.0000,
              1.0000, 0.9790, 1.0000, 1.0000, 0.9842, 1.0000, 0.9736, 1.0000, 0.9657,
              1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 0.9773, 1.0000,
              0.9892, 1.0000, 0.9818, 1.0000, 1.0000, 1.0000, 0.9621, 1.0000, 0.9734,
              0.9821, 0.9731, 1.0000, 1.0000, 0.9810, 1.0000, 1.0000, 0.9678, 0.9613,
              0.9762, 1.0000],
      'F1': [0.9810, 0.9811, 0.9894, 1.0000, 0.9793, 0.9687, 1.0000, 1.0000, 0.9912,
              1.0000, 1.0000, 1.0000, 1.0000, 0.9874, 1.0000, 0.9910, 1.0000, 1.0000,
              1.0000, 0.9825, 1.0000, 1.0000, 0.9886, 1.0000, 0.9772, 1.0000, 0.9704,
              1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 0.9816, 1.0000,
              0.9907, 1.0000, 0.9858, 1.0000, 1.0000, 1.0000, 0.9671, 1.0000, 0.9770,
              0.9864, 0.9764, 1.0000, 1.0000, 0.9835, 1.0000, 1.0000, 0.9752, 0.9689,
              0.9803, 1.0000]},
     {'BLEURT': [0.6465514302253723,
       0.7156470417976379,
       0.8583829402923584,
       0.9140881299972534,
       0.4719315767288208,
       0.19876842200756073,
       0.8706612586975098,
       0.9139382243156433,
       0.29393476247787476,
       0.8625785112380981,
       0.8891386389732361,
       0.9077739715576172,
       0.877536416053772,
       0.05282129347324371,
       0.8731096982955933,
       0.504294753074646,
       0.8668380975723267,
       0.8582901954650879,
       0.8999263644218445,
       0.18960873782634735,
       0.8666689991950989,
       0.8669843673706055,
       0.5742951035499573,
       0.8602033257484436,
       0.08691205084323883,
       0.8623600602149963,
       -0.19480891525745392,
       0.9265645742416382,
       0.8871315717697144,
       0.8783296942710876,
       0.9319407939910889,
       0.9183927774429321,
       0.867972195148468,
       0.9072103500366211,
       0.4609488844871521,
       0.9195150136947632,
       0.541954755783081,
       0.8937122821807861,
       0.4241940975189209,
       0.9246643781661987,
       0.894665002822876,
       0.863571286201477,
       -0.06064815819263458,
       0.9290639162063599,
       0.33862268924713135,
       0.6884748339653015,
       0.33100247383117676,
       0.9013016223907471,
       0.8928029537200928,
       0.39870351552963257,
       0.8885765075683594,
       0.8608013987541199,
       0.3303379416465759,
       0.18512322008609772,
       0.014984473586082458,
       0.8971254825592041]},
     {'Petersen': 0.9879518072289156,
      'Schnabel': 0.9130184331797235,
      'CAPTURE': 0.9642857142857143},
     [44,
      0,
      5,
      34,
      54,
      24,
      4,
      52,
      15,
      53,
      8,
      1,
      2,
      26,
      49,
      45,
      38,
      13,
      46,
      36,
      22,
      19,
      42]),
    ({'P': [0.9785, 1.0000, 1.0000, 0.9930, 1.0000, 0.9875, 1.0000, 0.9963, 1.0000,
              1.0000, 0.9719, 0.9930, 1.0000, 1.0000, 1.0000, 0.9878, 0.9922, 0.9905,
              0.9925, 1.0000],
      'R': [0.9726, 1.0000, 1.0000, 0.9895, 1.0000, 0.9778, 1.0000, 0.9936, 1.0000,
              1.0000, 0.9653, 0.9886, 1.0000, 1.0000, 1.0000, 0.9819, 0.9877, 0.9860,
              0.9879, 1.0000],
      'F1': [0.9755, 1.0000, 1.0000, 0.9912, 1.0000, 0.9826, 1.0000, 0.9949, 1.0000,
              1.0000, 0.9686, 0.9908, 1.0000, 1.0000, 1.0000, 0.9848, 0.9899, 0.9883,
              0.9902, 1.0000]},
     {'BLEURT': [0.4372093081474304,
       0.8415284156799316,
       0.8596140146255493,
       0.38722825050354004,
       0.9079397320747375,
       0.4535939693450928,
       0.8225417733192444,
       0.5029913783073425,
       0.8803172707557678,
       0.8454383611679077,
       -0.13368384540081024,
       0.3305913805961609,
       0.8642311096191406,
       0.9031375646591187,
       0.8697283267974854,
       0.27618056535720825,
       0.610012948513031,
       0.27493011951446533,
       0.4430604577064514,
       0.8486870527267456]},
     {'Petersen': 0.9924242424242424,
      'Schnabel': 0.8813559322033898,
      'CAPTURE': 0.975},
     [11, 15, 16, 7, 10, 5, 3, 0, 18, 17])]),
  (1.0,
   [({'P': [0.9849, 0.9855, 0.9922, 1.0000, 0.9859, 0.9774, 0.9889, 0.9881, 0.9933,
              0.9920, 0.9895, 0.9851, 1.0000, 0.9909, 0.9867, 0.9935, 0.9888, 0.9912,
              0.9597, 0.9860, 0.9902, 1.0000, 0.9930, 1.0000, 0.9808, 0.9906, 0.9751,
              1.0000, 0.9866, 1.0000, 1.0000, 0.9786, 1.0000, 0.9815, 0.9860, 1.0000,
              0.9922, 0.9874, 0.9898, 1.0000, 0.9939, 0.9882, 0.9721, 1.0000, 0.9805,
              0.9908, 0.9797, 0.9883, 0.9933, 0.9860, 0.9892, 0.9902, 0.9826, 0.9766,
              0.9844, 1.0000],
      'R': [0.9772, 0.9767, 0.9867, 1.0000, 0.9727, 0.9601, 0.9802, 0.9837, 0.9892,
              0.9889, 0.9801, 0.9789, 1.0000, 0.9840, 0.9794, 0.9885, 0.9818, 0.9853,
              0.9607, 0.9790, 0.9801, 1.0000, 0.9842, 1.0000, 0.9736, 0.9867, 0.9657,
              1.0000, 0.9832, 1.0000, 1.0000, 0.9697, 1.0000, 0.9752, 0.9773, 1.0000,
              0.9892, 0.9762, 0.9818, 1.0000, 0.9891, 0.9820, 0.9621, 1.0000, 0.9734,
              0.9821, 0.9731, 0.9841, 0.9892, 0.9810, 0.9803, 0.9861, 0.9678, 0.9613,
              0.9762, 1.0000],
      'F1': [0.9810, 0.9811, 0.9894, 1.0000, 0.9793, 0.9687, 0.9846, 0.9859, 0.9912,
              0.9905, 0.9848, 0.9820, 1.0000, 0.9874, 0.9830, 0.9910, 0.9853, 0.9882,
              0.9602, 0.9825, 0.9851, 1.0000, 0.9886, 1.0000, 0.9772, 0.9886, 0.9704,
              1.0000, 0.9849, 1.0000, 1.0000, 0.9741, 1.0000, 0.9783, 0.9816, 1.0000,
              0.9907, 0.9818, 0.9858, 1.0000, 0.9915, 0.9851, 0.9671, 1.0000, 0.9770,
              0.9864, 0.9764, 0.9862, 0.9912, 0.9835, 0.9848, 0.9881, 0.9752, 0.9689,
              0.9803, 1.0000]},
     {'BLEURT': [0.6465514302253723,
       0.7156470417976379,
       0.8583829402923584,
       0.9140881299972534,
       0.4719315767288208,
       0.19876842200756073,
       0.32693397998809814,
       0.035399630665779114,
       0.29393476247787476,
       0.5048642158508301,
       0.5585291385650635,
       0.18275217711925507,
       0.877536416053772,
       0.05282129347324371,
       0.4041402339935303,
       0.504294753074646,
       0.35460495948791504,
       0.49888455867767334,
       0.10012750327587128,
       0.18960873782634735,
       0.3464682698249817,
       0.8669843673706055,
       0.5742951035499573,
       0.8602033257484436,
       0.08691205084323883,
       0.5221036076545715,
       -0.19480891525745392,
       0.9265645742416382,
       0.38177478313446045,
       0.8783296942710876,
       0.9319407939910889,
       0.17404909431934357,
       0.867972195148468,
       -0.014940902590751648,
       0.4609488844871521,
       0.9195150136947632,
       0.541954755783081,
       0.36404263973236084,
       0.4241940975189209,
       0.9246643781661987,
       0.7010422945022583,
       0.4943934679031372,
       -0.06064815819263458,
       0.9290639162063599,
       0.33862268924713135,
       0.6884748339653015,
       0.33100247383117676,
       0.006469234824180603,
       0.29393476247787476,
       0.39870351552963257,
       0.5602491497993469,
       0.6594385504722595,
       0.3303379416465759,
       0.18512322008609772,
       0.014984473586082458,
       0.8971254825592041]},
     {'Petersen': 0.9490792410714286,
      'Schnabel': 0.7996031746031744,
      'CAPTURE': 0.9464285714285714},
     [15,
      52,
      13,
      5,
      20,
      17,
      26,
      45,
      33,
      11,
      8,
      37,
      22,
      41,
      18,
      14,
      53,
      54,
      44,
      24,
      7,
      16,
      51,
      50,
      6,
      48,
      25,
      38,
      40,
      28,
      31,
      1,
      46,
      19,
      49,
      36,
      10,
      42,
      34,
      47,
      0,
      9,
      4,
      2]),
    ({'P': [0.9785, 0.9951, 0.9914, 0.9930, 1.0000, 0.9875, 0.9926, 0.9963, 0.9920,
              0.9935, 0.9719, 0.9930, 0.9931, 0.9014, 0.9937, 0.9878, 0.9922, 0.9905,
              0.9925, 0.9867],
      'R': [0.9726, 0.9890, 0.9850, 0.9895, 1.0000, 0.9778, 0.9892, 0.9936, 0.9870,
              0.9890, 0.9653, 0.9886, 0.9858, 0.8961, 0.9894, 0.9819, 0.9877, 0.9860,
              0.9879, 0.9817],
      'F1': [0.9755, 0.9921, 0.9882, 0.9912, 1.0000, 0.9826, 0.9909, 0.9949, 0.9895,
              0.9913, 0.9686, 0.9908, 0.9894, 0.8987, 0.9915, 0.9848, 0.9899, 0.9883,
              0.9902, 0.9842]},
     {'BLEURT': [0.4372093081474304,
       0.464402437210083,
       0.39993321895599365,
       0.38722825050354004,
       0.9079397320747375,
       0.4535939693450928,
       0.6083594560623169,
       0.5029913783073425,
       0.05563373863697052,
       0.2590000033378601,
       -0.13368384540081024,
       0.3305913805961609,
       0.2440452128648758,
       -0.9837750196456909,
       0.3637900948524475,
       0.27618056535720825,
       0.610012948513031,
       0.27493011951446533,
       0.4430604577064514,
       0.3999238610267639]},
     {'Petersen': 0.9217391304347826,
      'Schnabel': 0.7857142857142858,
      'CAPTURE': 0.925},
     [12, 14, 10, 11, 15, 9, 2, 3, 1, 8, 13, 5, 0, 17, 16, 7, 19, 18, 6])])])
if __name__ == "__main__":
        test = VisData(example_data)
        # print(test.combined_data)
        # test.export_results()

        test = Visualize_(test)
        test.plot()